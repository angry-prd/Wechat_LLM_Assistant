# 腾讯云服务器Prisma数据库配置指南

本指南专为不懂代码的产品经理设计，帮助您在腾讯云服务器上正确配置Prisma数据库。

## 前置准备

1. 确保您已经在腾讯云服务器上创建了PostgreSQL或MySQL数据库
2. 记录下数据库的以下信息：
   - 数据库主机地址
   - 端口号（PostgreSQL默认为5432，MySQL默认为3306）
   - 数据库名称（建议使用：wechat_assistant）
   - 用户名
   - 密码

## 配置步骤

### 步骤1：修改环境变量文件

1. 在您的腾讯云服务器上，找到项目根目录下的`.env`文件
2. 使用文本编辑器（如nano或vim）打开该文件：
   ```
   nano .env
   ```
3. 找到以下内容：
   ```
   # 开发环境使用SQLite
   DATABASE_URL="file:./dev.db"
   
   # 生产环境使用PostgreSQL，部署到腾讯云时取消下面的注释并配置正确的连接信息
   # DATABASE_URL="postgresql://username:password@your-tencent-cloud-host:5432/wechat_assistant?schema=public"
   ```
4. 注释掉SQLite的配置行，取消PostgreSQL配置行的注释，并替换为您的实际数据库信息：
   ```
   # 开发环境使用SQLite
   # DATABASE_URL="file:./dev.db"
   
   # 生产环境使用PostgreSQL
   DATABASE_URL="postgresql://您的用户名:您的密码@您的数据库主机地址:5432/wechat_assistant?schema=public"
   ```
   
   如果您使用的是MySQL，则配置如下：
   ```
   # 开发环境使用SQLite
   # DATABASE_URL="file:./dev.db"
   
   # 生产环境使用MySQL
   DATABASE_URL="mysql://您的用户名:您的密码@您的数据库主机地址:3306/wechat_assistant"
   ```
5. 保存并关闭文件（在nano中按Ctrl+O保存，然后按Ctrl+X退出）

### 步骤2：修改Prisma配置文件

1. 打开`prisma/schema.prisma`文件：
   ```
   nano prisma/schema.prisma
   ```
2. 找到以下内容：
   ```
   datasource db {
     provider = "sqlite"
     url      = env("DATABASE_URL")
   }
   ```
3. 将`provider`的值从`"sqlite"`改为`"postgresql"`（如果您使用PostgreSQL）或`"mysql"`（如果您使用MySQL）：
   ```
   datasource db {
     provider = "postgresql" // 或 "mysql"
     url      = env("DATABASE_URL")
   }
   ```
4. 保存并关闭文件

### 步骤3：生成Prisma客户端

在项目根目录下运行以下命令：

```
npx prisma generate
```

这个命令会根据您的schema定义生成Prisma客户端代码。

### 步骤4：应用数据库迁移

在项目根目录下运行以下命令：

```
npx prisma migrate deploy
```

这个命令会将数据库结构应用到您的PostgreSQL或MySQL数据库中。

### 步骤5：重启应用

配置完成后，重启您的应用：

```
npm run build
npm run start
```

## 常见问题解答

### Q: 执行命令时出现"command not found"错误
**A**: 确保您已经安装了Node.js和npm。可以通过运行`node -v`和`npm -v`来检查。

### Q: 数据库连接失败
**A**: 检查以下几点：
- 确认数据库连接字符串中的用户名、密码和主机地址是否正确
- 确认数据库服务器是否允许远程连接
- 检查腾讯云安全组设置，确保已开放数据库端口（PostgreSQL默认5432，MySQL默认3306）

### Q: 执行migrate命令时出错
**A**: 可能是因为数据库用户权限不足。确保您使用的数据库用户有创建表的权限。

## 注意事项

1. 请妥善保管您的数据库密码，不要将包含密码的配置文件提交到代码仓库
2. 定期备份您的数据库内容
3. 在生产环境中，建议设置数据库的访问IP白名单，只允许应用服务器访问数据库

如果您在配置过程中遇到任何问题，请联系开发团队获取支持。